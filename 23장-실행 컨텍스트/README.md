# 23장. 실행 컨텍스트

`실행 컨텍스트 (Execution Context)` 는 자바스크립트의 동작 원리를 담고 있는 핵심 개념 입니다.

`실행 컨텍스트 (Execution Context)` 를 이해함으로써 얻게되는 개념은 다음과 같습니다.

* `스코프 기반` 으로 `식별자`와 `식별자에 바인딩된 값` 을 관리하는 방법
* `호이스팅 (Hoisting)` 이 발생하는 이유
* `클로저 (Closure)` 의 동작 방식
* `태스크 큐 (Task Queue)` 와 함께 동작하는 `이벤트 헨들러` 와 `비동기 처리` 의 동작 방식



<br /><hr /><br />



# 1. 소스코드의 타입

지금부터 `소스코드` 에는 `실행 가능한 코드(Executable Code)` 라는 의미를 부여 하겠습니다.

자바스크립트는 `소스코드 (실행 가능한 코드)` 를 `4가지` 로 분류하고 있습니다.

* 전역 코드
* 함수 코드
* eval 코드
* module 코드

<br />

`소스코드 (실행 가능한 코드)` 를 `4가지` 로 분류하는 이유는 각각의 `실행 컨텍스트 (Execution Context)` 를 생성하는 과정과 관리 내용이 다르기 때문 입니다.

<br />

* 전역 코드
  * 전역 코드의 평가가 시작되면 `전역 실행 컨텍스트` 를 생성한 후, 아래의 과정들을 진행하며, 생성된  `전역 스코프` 는 `전역 실행 컨텍스트` 가 관리하게 됩니다.
  * `전역 변수` 를 관리하기 위해, 최상위 스코프인 `전역 스코프` 를 생성 합니다.
  * 전역 변수를 전역 객체의 프로퍼티에 바인딩 합니다.
  * 전역 함수를 전역 객체의 메서드로 바인딩 합니다.

* 함수 코드
  * 함수 코드의 평가가 시작되면 `함수 실행 컨텍스트` 를 생성한 후, 아래의 과정들을 진행하며, 생성된 `지역 스코프` 는 `함수 실행 컨텍스트` 가 관리하게 됩니다.
  * `지역 변수`, `매개변수`, `arguments 객체` 를 관리하기 위해, `지역 스코프` 를 생성 합니다.
  * `지역 스코프` 를 `스코프 체인` 의 일원으로 연결 합니다.

* eval 코드
  * `strick mode (엄격 모드)` 에서만 해당 합니다.
  * eval 코드의 평가가 시작되면, `eval 실행 컨텍스트` 를 생성한 후, 아래의 과정 진행하며, 생성된 `eval 자신만의 스코프` 는 `eval 실행 컨텍스트` 가 관리하게 됩니다.
  * `eval 자신만의 스코프` 를 생성 합니다.

* module 코드
  * 모듈 코드의 평가가 시작되면, `모듈 실행 컨텍스트` 를 생성한 후, 아래의 과정들을 진행하며, 생성된 `모듈 스코프` 는 `모듈 실행 컨텍스트` 가 관리하게 됩니다.
  * module 별로 `독립적인 모듈 스코프` 를 생성 합니다.

<br />

이를 `소스코드` 와 `실행 컨텍스트` 의 관계로 나타내면 다음과 같습니다.

<br />

```bash
•   전역 코드  ───> 평가 ───> `전역 실행 컨텍스트` 및 `전역 스코프` 생성
•   함수 코드  ───> 평가 ───> `함수 실행 컨텍스트` 및 `지역 스코프` 생성
•  eval 코드  ───> 평가 ───> `eval 실행 컨텍스트` 및 `eval 스코프` 생성
* module 코드 ───> 평가 ───> `모듈 실행 컨텍스트` 및 `모듈 스코프` 생성
```



<br /><hr /><br />



# 2. 소스코드의 평가와 실행

자바스크립트 엔진은 소스코드를 2개의 과정으로 나누어 처리 합니다.

* 평가 과정
* 실행 과정 (런타임))



<br /><hr /><br />



## 2-1. 평가 과정

먼저 `실행 컨텍스트` 를 만듭니다.

그리고 변수나 함수 `선언문` 만을 먼저 실행하여 변수나 함수를 생성 합니다.

생성된 변수나 함수는 `식별자` 를 `키값` 으로 사용하여 `실행 컨텍스트` 가 관리하는 `스코프` 에 등록 합니다.

<br />

아래 코드의 `평가 과정` 에서는 `var x;` 만 실행하여, 변수 `x` 를 `실행 컨텍스트` 가 관리하는 `스코프` 에 등록 합니다.

그리고 등록 대상이 `변수` 일 경우에는 `undefined` 로 초기화 하며, `함수` 일 경우에는 `Function 객체` 로 초기화 합니다.

<br />

```javascript
var x;
x = 3;
```



<br /><hr /><br />



## 2-2. 실행 과정 (런타임)

`선언문` 을 제외한 소스코드를 순차적으로 실행 시킵니다.

이는 `평가 과정` 에서 `모든 선언문` 을 `실행 컨텍스트` 가 관리하는 `스코프` 에 등록해 두었기 때문입니다.

이렇게 `실행한 결과` 는 다시 `실행 컨텍스트` 가 관리하는 `스코프` 에 재등록(값 갱신) 합니다.

<br />

아래 코드의 `실행 과정` 에서는 `x = 3;` 만 실행하고, 실행 결과는 `실행 컨텍스트` 가 관리하는 `스코프` 에 다시 등록 합니다.

<br />

이렇게 `실행 과정` 에서 변수나 함수를 참조할 때, 해당 참조값은 `실행 컨텍스트` 가 관리하는 `스코프` 에서부터 검색합니다.

만약 `현재 스코프` 에서 참조값을 찾지 못하였다면, `스코프 체인` 을 통해 `상위 스코프 전체` 에서 검색하게 됩니다.



<br /><hr /><br />



# 3. 실행 컨텍스트의 역할

`실행 컨텍스트` 는 아래의 요소로 구성되어 있습니다.

* `스코프`
  * 변수, 함수, class 등의 `식별자` 를 등록하고 관리 합니다.

* `함수 실행 순서 내부 메커니즘`
  * 코드의 실행 순서를 관리 합니다.

<br />

그리고 `스코프` 와 `함수 실행 순서 내부 메커니즘` 은 아래의 요소로 관리 합니다.

* `렉시컬 환경`
  * `스코프` 를 관리 합니다.

* `실행 컨텍스트 스택`
  * `함수 실행 순서` 를 관리하는 메커니즘 입니다.

<br />

아래의 예시 코드를 통해 `소스코드` 를 어떻게 `평가` 하고 `실행` 하는지 순차적으로 살펴보겠습니다.

```javascript
// TODO: 실행 컨텍스트의 역할 흐름 정리하기
// TODO: 실행 컨텍스트의 역할 흐름 정리하기
// TODO: 실행 컨텍스트의 역할 흐름 정리하기
```
